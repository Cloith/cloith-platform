apiVersion: skaffold/v4beta11
kind: Config
metadata:
  name: cloith-platform
build:
  artifacts:
    - image: docker.io/cloith/frontend
      context: apps/chatter/frontend
      sync:
        manual:
          - src: 'src/**/*'
            dest: .
          - src: 'index.html'
            dest: .
    - image: docker.io/cloith/backend
      context: apps/chatter/backend
      sync:
        manual:
          - src: '**/*.js'
            dest: .
manifests:
  rawYaml:
    # 1. Namespaces & Infrastructure
    - infrastructure-collections/k3s-ngf-1c-1n-dev/namespaces/*.yaml

    # 2. Configuration & Secrets (Apply before Apps)
    - k3s-secrets/backend-secrets-dev.yaml
    - infrastructure-collections/k3s-ngf-1c-1n-dev/shared-services/mqtt/mosquitto-config.yaml

    # 3. Applications (Deployments & Services)
    - infrastructure-collections/k3s-ngf-1c-1n-dev/shared-services/mqtt/mosquitto-dev.yaml
    - infrastructure-collections/k3s-ngf-1c-1n-dev/apps/chatter/frontend/frontend-dev.yaml
    - infrastructure-collections/k3s-ngf-1c-1n-dev/apps/chatter/backend/backend-dev.yaml

    # 4. Networking (Routes & Permissions)
    - infrastructure-collections/k3s-ngf-1c-1n-dev/shared-services/mqtt/mqtt-route.yaml
    - infrastructure-collections/k3s-ngf-1c-1n-dev/shared-services/mqtt/reference-grant.yaml
    - infrastructure-collections/k3s-ngf-1c-1n-dev/apps/chatter/frontend/frontend-route.yaml
    - infrastructure-collections/k3s-ngf-1c-1n-dev/apps/chatter/backend/backend-route.yaml
deploy:
  kubectl: {}